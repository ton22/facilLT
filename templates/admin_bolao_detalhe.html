{% extends "layout.html" %}
{% block title %}Bolão: {{ bolao.nome }}{% endblock %}
{% block content %}
<h2 class="mb-3"><i class="fa fa-users"></i> Bolão — {{ bolao.nome }}</h2>

<div class="card mb-3">
  <div class="card-body">
    <form method="post">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <div class="row g-2">
        <div class="col-md-4">
          <label class="form-label">Resultado (15 números, separados por vírgula)</label>
          <input class="form-control" name="resultado" value="{{ bolao.resultado_json }}" placeholder="1,2,3,...,25">
        </div>
        <div class="col-md-8">
          <div class="row g-2">
            <div class="col">
              <label class="form-label">Valor 11 pts</label>
              <input class="form-control" name="valor_11" placeholder="0.00">
            </div>
            <div class="col">
              <label class="form-label">Valor 12 pts</label>
              <input class="form-control" name="valor_12" placeholder="0.00">
            </div>
            <div class="col">
              <label class="form-label">Valor 13 pts</label>
              <input class="form-control" name="valor_13" placeholder="0.00">
            </div>
            <div class="col">
              <label class="form-label">Valor 14 pts</label>
              <input class="form-control" name="valor_14" placeholder="0.00">
            </div>
            <div class="col">
              <label class="form-label">Valor 15 pts</label>
              <input class="form-control" name="valor_15" placeholder="0.00">
            </div>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <button class="btn btn-primary"><i class="fa fa-save"></i> Salvar e Recalcular</button>
        <a class="btn btn-secondary" href="{{ url_for('painel_admin') }}"><i class="fa fa-arrow-left"></i> Voltar</a>
      </div>
    </form>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">Convidar usuário</div>
      <div class="card-body">
        <form method="post" action="{{ url_for('convidar_para_bolao', bolao_id=bolao.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          <div class="row g-2">
            <div class="col">
              <input class="form-control" name="usuario" placeholder="Nome do usuário" required>
            </div>
            <div class="col">
              <input class="form-control" name="jogos_permitidos" placeholder="Jogos permitidos" value="1">
            </div>
            <div class="col-auto">
              <button class="btn btn-success"><i class="fa fa-paper-plane"></i> Convidar</button>
            </div>
          </div>
        </form>
        <ul class="list-group mt-3">
          {% for c in convites %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              ID {{ c.id }} — Usuário #{{ c.usuario_id }} — {{ c.status }} — Jogos: {{ c.jogos_permitidos }}
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">Jogos do Bolão</div>
      <div class="card-body">
        <table class="table table-sm">
          <thead>
            <tr><th>ID</th><th>Usuário</th><th>Números</th><th>Pontos</th><th>Premio</th></tr>
          </thead>
          <tbody>
            {% for j in jogos %}
              <tr>
                <td>{{ j.id }}</td>
                <td>{{ j.usuario_id }}</td>
                <td>{{ j.numeros_json }}</td>
                <td>{{ j.pontos if j.pontos is not none else '-' }}</td>
                <td>{{ '%.2f'|format(j.premio_calculado or 0) }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="mt-2">
          <strong>Totais por faixa:</strong>
          <ul class="small">
            {% for k,v in total_por_faixa.items() %}
              <li>{{ k }} pontos: {{ v }} jogos — total R$ {{ '%.2f'|format(soma_por_faixa.get(k, 0)) }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

