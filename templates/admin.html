{% extends "layout.html" %}
{% block title %}Painel do Administrador{% endblock %}
{% block content %}
<h2 class="mb-4"><i class="fa fa-crown"></i> Painel do Administrador</h2>

<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title mb-3"><i class="fa fa-file-import me-2"></i>Importar histórico (XLSX)</h5>
    <form action="{{ url_for('importar_historico') }}" method="post" enctype="multipart/form-data" class="row g-2 align-items-center">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <div class="col-sm-8 col-md-9">
        <input class="form-control" type="file" name="arquivo" accept=".xlsx" required>
        <div class="form-text">Envie o arquivo historico.xlsx no formato Excel (.xlsx). A planilha "historico" será usada se existir.</div>
      </div>
      <div class="col-sm-4 col-md-3">
        <button type="submit" class="btn btn-primary w-100"><i class="fa fa-upload me-1"></i> Importar Arquivo</button>
      </div>
    </form>
  </div>
</div>

<h4 class="mt-4">Usuários pendentes de aprovação</h4>
{% if pendentes %}
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for u in pendentes %}
        <tr>
            <td>{{ u.nome }}</td>
            <td>
                <form action="{{ url_for('aprovar', id=u.id) }}" method="post" style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-success btn-sm"><i class="fa fa-check"></i> Aprovar</button>
                </form>
                <form action="{{ url_for('excluir', id=u.id) }}" method="post" style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Excluir usuário?');"><i class="fa fa-trash"></i> Excluir</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>Nenhum usuário pendente.</p>
{% endif %}

<h4 class="mt-5">Usuários aprovados</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Tipo</th>
        </tr>
    </thead>
    <tbody>
        {% for u in aprovados %}
        <tr>
            <td>{{ u.nome }}</td>
            <td>{{ u.tipo }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<hr/>
<h4 class="mt-4">Bolões</h4>
<form action="{{ url_for('criar_bolao') }}" method="post" class="row g-2 mb-3">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    <div class="col-md-4">
        <input class="form-control" name="nome" placeholder="Nome do bolão" required>
    </div>
    <div class="col-md-3">
        <input class="form-control" name="numero_concurso" placeholder="Número do concurso">
    </div>
    <div class="col-md-3">
        <input class="form-control" name="data_sorteio" placeholder="Data sorteio (YYYY-MM-DD)">
    </div>
    <div class="col-md-2">
        <button class="btn btn-primary w-100" type="submit"><i class="fa fa-plus"></i> Criar Bolão</button>
    </div>
    </form>

{% if bolaos %}
<div class="row">
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">Bolões Abertos</div>
      <div class="list-group list-group-flush">
        {% for b in bolaos if b.status == 'aberto' %}
        <a href="{{ url_for('detalhe_bolao', bolao_id=b.id) }}" class="list-group-item list-group-item-action">
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1">{{ b.nome }}</h6>
            <span class="badge bg-success">aberto</span>
          </div>
          <small>Concurso: {{ b.numero_concurso or '-' }} • Data: {{ b.data_sorteio|datetime_short if b.data_sorteio else '-' }}</small>
        </a>
        {% else %}
        <div class="list-group-item"><small class="text-muted">Nenhum bolão aberto.</small></div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">Bolões Finalizados</div>
      <div class="list-group list-group-flush">
        {% for b in bolaos if b.status != 'aberto' %}
        <a href="{{ url_for('detalhe_bolao', bolao_id=b.id) }}" class="list-group-item list-group-item-action">
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1">{{ b.nome }}</h6>
            <span class="badge bg-secondary">{{ b.status }}</span>
          </div>
          <small>Concurso: {{ b.numero_concurso or '-' }} • Data: {{ b.data_sorteio|datetime_short if b.data_sorteio else '-' }}</small>
        </a>
        {% else %}
        <div class="list-group-item"><small class="text-muted">Nenhum bolão finalizado.</small></div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% else %}
<p class="text-muted">Nenhum bolão criado ainda.</p>
{% endif %}

<a href="{{ url_for('index') }}" class="btn btn-secondary mt-3"><i class="fa fa-arrow-left"></i> Voltar</a>
{% endblock %}
